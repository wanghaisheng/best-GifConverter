import{d as I,i as w,z as U,A as V,o as S,c as D,w as _,k as p,u as m,B as h,h as C,j as g,v as y,b as v,t as k,C as j,x as O,s as R,q as E,D as L,a as T,e as z,y as A}from"./vendor-BCqAv1Ex.js";import{F as H,r as P,c as W,_ as Y}from"./common-DXkHsSyv.js";import{V as $,c as F}from"./video-CM5JDtN2.js";import{_ as x}from"./index-CWiJIzWu.js";const N={class:"container"},q={class:"camera-record-tip"},G={class:"tip-second"},J={class:"camera-loading"},K=I({__name:"camera",props:{resolve:{type:Function}},setup(c){const n=c,u=w(!0),a=w(),i=U({interval:0,startTime:0,second:""}),o=w(0);let l=[],r=new MediaStream,s;const t={async onCameraOpen(){var M;r=await navigator.mediaDevices.getUserMedia({video:!0});const d=r.getVideoTracks()[0],{width:e,height:f}=d.getSettings(),B=((M=a.value)==null?void 0:M.clientWidth)*(f/e);a.value.style.height=`${B}px`,a.value.srcObject=r,a.value.controls=!1,a.value.addEventListener("loadedmetadata",()=>{a.value.play(),o.value=1},{once:!0})},onCameraClose(){r.getTracks().forEach(d=>d.stop()),o.value=0},onRecordStart(){a.value.srcObject=r,a.value.controls=!1,a.value.play(),l=[],o.value=2,s=new MediaRecorder(r,{mimeType:"video/mp4"}),s.start(),i.startTime=0;const d=()=>{i.startTime++;const e=String(Math.floor(i.startTime/3600)).padStart(2,"0"),f=String(Math.floor(i.startTime%3600/60)).padStart(2,"0"),b=String(i.startTime%60).padStart(2,"0");i.second=`${e}:${f}:${b}`};d(),i.interval=window.setInterval(d,1e3),s.addEventListener("dataavailable",e=>l.push(e.data)),s.addEventListener("stop",()=>{a.value.srcObject=null,a.value.src=URL.createObjectURL(new Blob(l)),a.value.play(),a.value.controls=!0})},onRecordStop(){s==null||s.stop(),t.onCameraClose(),i.interval&&clearInterval(i.interval),o.value=3},async onRecordRestart(){r=await navigator.mediaDevices.getUserMedia({video:!0}),t.onRecordStart()},onModalClose(){u.value=!1,t.onCameraClose()},onVideoSave(){u.value=!1,n.resolve(new Blob(l))}};return V(()=>{t.onCameraOpen()}),(d,e)=>(S(),D(m(j),{visible:u.value,"onUpdate:visible":e[0]||(e[0]=f=>u.value=f),title:"摄像头录制",width:"650px","unmount-on-close":"",draggable:"","body-style":{padding:"10px"},closable:!1,"esc-to-close":!1,"mask-closable":!1},{footer:_(()=>[p(m(h),{onClick:t.onModalClose},{default:_(()=>e[2]||(e[2]=[C("关闭窗口")])),_:1},8,["onClick"]),g(p(m(h),{type:"primary",onClick:t.onRecordStart},{default:_(()=>e[3]||(e[3]=[C(" 开始录制 ")])),_:1},8,["onClick"]),[[y,o.value===1]]),g(p(m(h),{type:"primary",status:"danger",onClick:t.onRecordStop},{default:_(()=>e[4]||(e[4]=[C(" 结束录制 ")])),_:1},8,["onClick"]),[[y,o.value===2]]),g(p(m(h),{type:"primary",onClick:t.onRecordRestart},{default:_(()=>e[5]||(e[5]=[C(" 重新录制 ")])),_:1},8,["onClick"]),[[y,o.value===3]]),g(p(m(h),{type:"primary",onClick:t.onVideoSave},{default:_(()=>e[6]||(e[6]=[C(" 保存 ")])),_:1},8,["onClick"]),[[y,o.value===3]])]),default:_(()=>[v("div",N,[g(v("div",q,[e[1]||(e[1]=v("div",{class:"tip-dot"},null,-1)),v("div",G,k(i.second),1)],512),[[y,o.value===2]]),g(v("div",J,"loading...",512),[[y,o.value===0]]),v("video",{class:"camera-player",ref_key:"video",ref:a},null,512)])]),_:1},8,["visible"]))}}),Q=x(K,[["__scopeId","data-v-a3364030"]]);function X(){const c=w([]),n=w([]);return{items:c,selected:n,onAddItem:async()=>{const l=await new Promise(d=>{const e=p(Q,{resolve:d}),f=document.createElement("div");L(e,f);const b=e.el;document.body.appendChild(b)}),r=URL.createObjectURL(l),s=await $.getVideoObject(r),t={id:$.getId(),url:r,name:"录像"+new Date().getTime(),size:H.formatSize(l.size),type:"mp4",dpi:{width:s.videoWidth,height:s.videoHeight},file:l,duration:parseInt(s.duration*10+"")/10,lastModified:O().format("YYYY-MM-DD HH:mm:ss")};c.value.push(t)},onRemoveItems:async o=>{const l=c.value.filter(({id:t})=>o.includes(t)).map(({name:t})=>t);if(!await P(l))return;const s=R.remove(c.value,({id:t})=>o.includes(t));R.remove(n.value,t=>o.includes(t)),E.success(`成功移除 ${s.length} 个视频`)},onConvertItems:async()=>{const o=c.value.filter(({id:l})=>n.value.includes(l));await W("video",o)}}}const Z={class:"image-info"},ee=["src"],te={class:"info-base"},ae={class:"info-name"},oe={class:"info-size"},se=I({__name:"profile",props:{data:{}},setup(c){const n=c,u=()=>{F(n.data.url)};return(a,i)=>(S(),T("div",Z,[v("video",{fit:"cover",src:a.data.url,width:50,height:34,onClick:u},null,8,ee),v("div",te,[v("div",ae,k(a.data.name),1),v("div",oe,k(a.data.size),1)])]))}}),ne=x(se,[["__scopeId","data-v-5ee3ae74"]]),ie={class:"page"},le=I({__name:"index",setup(c){const{selected:n,items:u,onAddItem:a,onRemoveItems:i,onConvertItems:o}=X(),l=z(()=>[{text:"摄像头录制",type:"primary",onClick:()=>a()},{text:"批量删除",type:"primary",disabled:n.value.length<=0,onClick:()=>i(n.value)},{text:"转化选择项",type:"primary",disabled:n.value.length<=0,onClick:()=>o()}]),r=[{title:"基础信息",dataIndex:"name",width:400,render:({record:s})=>p(ne,{data:s},null)},{title:"视频分辨率",dataIndex:"dpi",align:"center",render:({record:s})=>`${s.dpi.width} * ${s.dpi.height}`},{title:"视频时长(秒)",dataIndex:"duration",align:"center"},{title:"视频类型",dataIndex:"type",align:"center"},{title:"最后编辑时间",dataIndex:"lastModified",align:"center"}];return(s,t)=>(S(),T("div",ie,[p(m(Y),{selected:m(n),"onUpdate:selected":t[0]||(t[0]=d=>A(n)?n.value=d:null),options:{rowSelection:{type:"radio"}},data:m(u),operates:l.value,columns:r},null,8,["selected","data","operates"])]))}}),ue=x(le,[["__scopeId","data-v-e307e129"]]);export{ue as default};
